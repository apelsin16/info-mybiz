(() => {

    const actualAddressToggle = () => {

        const actualAddress = document.getElementById("actualAddress");

        const hideForm = () => {
            actualAddress.setAttribute("class", "d-none");
        }

        const showForm = () => {
            actualAddress.setAttribute("class", "d-block");
        }


        const adressTrue = document.getElementById("adressTrue");
        adressTrue.addEventListener("click", hideForm);

        const adressInsert = document.getElementById("adressInsert");
        adressInsert.addEventListener("click", showForm);

        if (adressTrue.hasAttribute("checked")) hideForm();
    }

    actualAddressToggle();

    const addContactPhone = () => {
        const existPhones = [];
        let socialsCheckedArrIds = [];
        let socialsCheckedArr = [];

        // const socialsChecked = document.querySelectorAll('.js-init-phone > label > input');
        const inputPhoneNumber = document.querySelector('.js-init-phone > input');
        const addBtn = document.getElementById('addBtn');

        addBtn.addEventListener('click', () => {
            event.preventDefault();

            const socials = document.querySelectorAll('.js-socials > input:checked');
            socialsCheckedArr = Array.from(socials);
            socialsCheckedArr.forEach(item => {
                socialsCheckedArrIds.push(item.id);
            });

            const obj = {};

            obj.name = inputPhoneNumber.value;
            obj.socials = socialsCheckedArr;

            const validation = (val) => {
                let isValid = true;
                existPhones.forEach((item) => {
                    if (item[val]) {
                        isValid = false;
                    }                            
                })
                return isValid;
            }

            if (inputPhoneNumber.value == '' ) {
                alert("Вы должны ввести номер телефона")
                return
            } else if (!validation(inputPhoneNumber.value)) {
                alert('Вы уже вводили этот номер')
                return
            } else if (existPhones.length > 4) {
                alert("Вы не можете ввести более 5 номеров телефонов")
                return
            } else {
                 existPhones.push(obj);
            }

            
            
            const existPhonesArr = (arr1, arr2) => arr1.map( item => {
                arr2.filter( phone => {
                    phone.name === item.textContent;
                })
                
            })
            
            renderTable(socialsCheckedArrIds, obj.name, existPhones, existPhonesArr, phonesArr );


            inputPhoneNumber.value = '';
            socialsCheckedArrIds = [];
            for ( let i = 0; i < socials.length; i++) {
                socials[i].removeAttribute('checked');             
            }

            const phones = document.querySelectorAll('#phoneTable > tr > .js-name');
            const phonesArr = Array.from(phones);
            

            // const filtered = existPhones.filter( phone = {

            // } )
            

        });
    }

    addContactPhone();



    function renderTable ( arrSocials, phone, arr, func, arr0 )  {
        const table = document.getElementById('phoneTable');

        const tr = document.createElement('tr');
        const th = document.createElement('th');
        th.textContent = arr.length;
        const tdName = document.createElement('td');
        tdName.classList.add('js-name');
        tdName.textContent = phone;
        const tdSocials = document.createElement('td');
        tdSocials.classList.add('socials');
        const tdButton = document.createElement('td');
        const delButton = document.createElement('button');
        delButton.classList.add('button');
        delButton.textContent = '-';
        tdButton.append(delButton);

        delButton.addEventListener('click', (e) => {
            e.preventDefault();
            tr.style.display = 'none';
            func(arr0, arr );
        })

        tr.append(th);
        tr.append(tdName);        
        tr.append(tdSocials);
        tr.append(tdButton);
        
        const imgTelegram = document.createElement('img');
        imgTelegram.setAttribute('src', '../img/telegram.svg');
        imgTelegram.setAttribute('alt', 'telegram');

        const imgFax = document.createElement('img');
        imgFax.setAttribute('src', '../img/fax.png');
        imgFax.setAttribute('alt', 'fax');

        const imgViber = document.createElement('img');
        imgViber.setAttribute('src', '../img/viber.svg');
        imgViber.setAttribute('alt', 'viber');

        const imgWhatsup = document.createElement('img');
        imgWhatsup.setAttribute('src', '../img/whatsapp.svg');
        imgWhatsup.setAttribute('alt', 'whats up');

        arrSocials.forEach( item => {
        switch (item) {
            case "fax":
                tdSocials.append(imgFax);
                break;
            case "telegram":
                tdSocials.append(imgTelegram);
                break;
            case "viber":
                tdSocials.append(imgViber);
                break;
            case "whatsup":
                tdSocials.append(imgWhatsup);
                break;

            default:
                break;
        }
    })
        table.insertAdjacentElement('afterbegin', tr);
    }



    

})();